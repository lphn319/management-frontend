<h2 mat-dialog-title>
    {{ isEditMode ? 'Chỉnh sửa nhân viên' : viewOnly ? 'Chi tiết nhân viên' : 'Thêm nhân viên mới' }}
</h2>

<form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
    <div mat-dialog-content>
        <mat-tab-group>
            <mat-tab label="Thông tin cá nhân">
                <div class="form-grid tab-content">
                    <!-- Thông tin cá nhân -->
                    <div class="section-title full-width">Thông tin cá nhân</div>

                    <!-- Họ và tên -->
                    <mat-form-field appearance="outline">
                        <mat-label>Họ và tên</mat-label>
                        <input matInput formControlName="name" placeholder="Nhập họ tên nhân viên"
                            [readonly]="viewOnly">
                        <mat-error *ngIf="isFieldInvalid('name')">
                            {{ getErrorMessage('name') }}
                        </mat-error>
                    </mat-form-field>

                    <!-- Email -->
                    <mat-form-field appearance="outline">
                        <mat-label>Email</mat-label>
                        <input matInput formControlName="email" placeholder="Nhập email" type="email"
                            [readonly]="viewOnly">
                        <mat-error *ngIf="isFieldInvalid('email')">
                            {{ getErrorMessage('email') }}
                        </mat-error>
                    </mat-form-field>

                    <!-- Số điện thoại -->
                    <mat-form-field appearance="outline">
                        <mat-label>Số điện thoại</mat-label>
                        <input matInput formControlName="phoneNumber" placeholder="Nhập số điện thoại"
                            [readonly]="viewOnly">
                        <mat-error *ngIf="isFieldInvalid('phoneNumber')">
                            {{ getErrorMessage('phoneNumber') }}
                        </mat-error>
                    </mat-form-field>

                    <!-- Mật khẩu (chỉ hiển thị khi thêm mới hoặc sửa) -->
                    <mat-form-field appearance="outline" *ngIf="!viewOnly">
                        <mat-label>{{ isEditMode ? 'Mật khẩu mới (để trống nếu không đổi)' : 'Mật khẩu' }}</mat-label>
                        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password">
                        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword"
                            [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePassword" type="button">
                            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
                        </button>
                        <mat-error *ngIf="isFieldInvalid('password')">
                            {{ getErrorMessage('password') }}
                        </mat-error>
                    </mat-form-field>

                    <!-- Ngày sinh -->
                    <mat-form-field appearance="outline">
                        <mat-label>Ngày sinh</mat-label>
                        <input matInput [matDatepicker]="birthDatePicker" formControlName="dateOfBirth"
                            [readonly]="viewOnly">
                        <mat-datepicker-toggle matSuffix [for]="birthDatePicker"
                            [disabled]="viewOnly"></mat-datepicker-toggle>
                        <mat-datepicker #birthDatePicker></mat-datepicker>
                        <mat-error *ngIf="isFieldInvalid('dateOfBirth')">
                            Ngày sinh là bắt buộc
                        </mat-error>
                    </mat-form-field>

                    <!-- Giới tính -->
                    <mat-form-field appearance="outline">
                        <mat-label>Giới tính</mat-label>
                        <mat-select formControlName="gender" [disabled]="viewOnly">
                            <mat-option value="MALE">Nam</mat-option>
                            <mat-option value="FEMALE">Nữ</mat-option>
                            <mat-option value="OTHER">Khác</mat-option>
                        </mat-select>
                        <mat-error *ngIf="isFieldInvalid('gender')">
                            Giới tính là bắt buộc
                        </mat-error>
                    </mat-form-field>
                </div>
            </mat-tab>

            <mat-tab label="Thông tin công việc">
                <div class="form-grid tab-content">
                    <!-- Thông tin công việc -->
                    <div class="section-title full-width">Thông tin công việc</div>

                    <!-- Phòng ban -->
                    <mat-form-field appearance="outline">
                        <mat-label>Phòng ban</mat-label>
                        <mat-select formControlName="departmentId" [disabled]="viewOnly">
                            <mat-option *ngFor="let dept of departments" [value]="dept.id">
                                {{ dept.name }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="isFieldInvalid('departmentId')">
                            Phòng ban là bắt buộc
                        </mat-error>
                    </mat-form-field>

                    <!-- Vai trò -->
                    <mat-form-field appearance="outline">
                        <mat-label>Vai trò</mat-label>
                        <mat-select formControlName="roleId" [disabled]="viewOnly">
                            <mat-option *ngFor="let role of roles" [value]="role.id">
                                {{ role.name }}
                            </mat-option>
                        </mat-select>
                        <mat-error *ngIf="isFieldInvalid('roleId')">
                            Vai trò là bắt buộc
                        </mat-error>
                    </mat-form-field>

                    <!-- Hiển thị quyền truy cập -->
                    <div class="permissions-container full-width">
                        <div class="permission-title">Quyền truy cập:</div>
                        <div class="permission-chips">
                            <mat-chip-set>
                                <ng-container *ngFor="let permission of getSelectedRolePermissions()">
                                    <mat-chip color="primary">
                                        {{ permissionLabels[permission] || permission }}
                                    </mat-chip>
                                </ng-container>
                            </mat-chip-set>
                        </div>
                    </div>

                    <!-- Trạng thái -->
                    <mat-form-field appearance="outline">
                        <mat-label>Trạng thái</mat-label>
                        <mat-select formControlName="isActive" [disabled]="viewOnly">
                            <mat-option [value]="true">Đang làm việc</mat-option>
                            <mat-option [value]="false">Đã nghỉ việc</mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
            </mat-tab>
        </mat-tab-group>
    </div>

    <div mat-dialog-actions align="end">
        <button mat-button type="button" (click)="onCancel()">
            {{ viewOnly ? 'Đóng' : 'Hủy' }}
        </button>
        <button mat-raised-button color="primary" type="submit" *ngIf="!viewOnly" [disabled]="employeeForm.invalid">
            {{ isEditMode ? 'Lưu' : 'Thêm' }}
        </button>
    </div>
</form>